{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8814867654641298"
        crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lokkal News - Your Local News Source</title>
    <meta name="description"
        content="Stay updated with the latest local news, trending stories, and community updates from your area.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S7CS0M36G9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-S7CS0M36G9');
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hero-section {
            position: relative;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("{% static 'news_app/images/homepagebackground.webp' %}");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            filter: blur(3px);
            z-index: -2;
        }

        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(rgb(255 255 255 / 53%), rgb(0 0 0 / 28%));
            z-index: -1;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .search-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            border-color: #4285f4;
            box-shadow: 0 4px 25px rgba(66, 133, 244, 0.3);
        }

        .search-button {
            background: linear-gradient(135deg, #4285f4, #3367d6);
            border-radius: 50px;
            width: 52px;
            height: 52px;
            transition: all 0.3s ease;
        }

        .search-button:hover {
            background: linear-gradient(135deg, #3367d6, #2952cc);
            transform: scale(1.05);
        }

        .news-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .featured-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .featured-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .category-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trending-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .popular-area-chip {
            background: rgb(255 74 74 / 90%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .popular-area-chip:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .section-header {
            position: relative;
            padding-bottom: 12px;
            margin-bottom: 24px;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .breaking-news-ticker {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 12px 0;
            overflow: hidden;
            position: relative;
        }

        .ticker-content {
            display: flex;
            animation: scroll 30s linear infinite;
        }

        @keyframes scroll {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .quick-links {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-link-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: white;
            text-decoration: none;
        }

        .quick-link-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .welcome-banner-animation {
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-backdrop {
            backdrop-filter: blur(5px);
        }

        @media (max-width: 768px) {
            .hero-section {
                background-attachment: scroll;
            }

            .search-box {
                margin: 0 16px;
            }

            input[type="text"] {
                font-size: 16px;
            }

            #welcome-banner {
                padding: 16px 8px;
            }

            #welcome-banner .flex-col {
                flex-direction: column;
            }

            #welcome-banner .gap-2 {
                gap: 8px;
            }
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Welcome Banner -->
    <div id="welcome-banner" class="hidden bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 text-center shadow-lg welcome-banner-animation">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-center mb-2">
                <span class="text-2xl mr-2">üëã</span>
                <h2 class="text-xl font-bold">Welcome to LOKKAL News!</h2>
            </div>
            <p class="text-lg mb-2">Here, community voices become real stories.</p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-2 text-sm mb-3">
                <span>‚Ä¢ You share your comments.</span>
                <span>‚Ä¢ Our AI editor summarizes them.</span>
                <span>‚Ä¢ The result: clear news updates for everyone in your community.</span>
            </div>
            <div class="flex flex-col sm:flex-row justify-center gap-3">
                <button id="get-started-btn" class="bg-white text-blue-600 font-bold py-2 px-6 rounded-lg hover:bg-gray-100 transition-colors flex items-center justify-center">
                    <i class="fas fa-rocket mr-2"></i>
                    Get Started
                </button>
                <button id="dismiss-banner" class="bg-transparent border border-white text-white font-bold py-2 px-6 rounded-lg hover:bg-white hover:text-blue-600 transition-colors">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <div id="location-denied-banner" class="hidden bg-yellow-400 text-black p-3 text-center shadow-md">
        <span class="font-medium">Allow location access to see what's happening around you.</span>
        <button id="request-location-access" class="ml-4 bg-blue-600 text-white font-bold py-1 px-4 rounded-lg hover:bg-blue-700 transition-colors">
            Allow
        </button>
    </div>
    <!-- Header Navigation -->
    <nav class="header-nav sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <img src="{% static 'news_app/images/transparent.webp' %}" alt="Lokkal News" class="h-10 w-auto">
                    <div class="hidden md:flex space-x-6">
                        <a href="{% url 'enter_area' %}" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
                        <a href="{% url 'all-articles-view' %}"
                            class="text-gray-700 hover:text-blue-600 font-medium">Local News</a>
                        <a href="#trending" class="text-gray-700 hover:text-blue-600 font-medium">Trending</a>
                        <a href="#community" class="text-gray-700 hover:text-blue-600 font-medium">Community</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="text-gray-700 hover:text-blue-600" onclick="toggleNotifications()">
                        <i class="fas fa-bell text-lg"></i>
                    </button>
                    <a href="{% url 'post-create' %}"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Submit News
                    </a>
                </div>
            </div>
        </div>
    </nav>



    <!-- Hero Section -->
    <section class="hero-section text-white py-20" style="padding-top: 0px;">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <!-- Logo -->
            <div>
                <img src="{% static 'news_app/images/transparent.webp' %}" alt="Lokkal News"
                    class="h-50 md:h-80 w-auto mx-auto">
            </div>

            <!-- <h1 class="text-4xl md:text-6xl font-bold mb-6">
                Stay Connected to Your <span class="text-yellow-400">Community</span>
            </h1> -->
            <p class="text-xl md:text-2xl mb-8 text-gray-200">
                Discover what's happening in your neighborhood with real-time local news and community updates
            </p>

            <!-- Enhanced Search Section -->
            <div class="max-w-2xl mx-auto mb-8">
                <form action="{% url 'enter_area' %}" method="POST" class="relative">
                    {% csrf_token %}
                    <div class="flex items-center search-box p-2">
                        <i class="fas fa-map-marker-alt text-gray-400 ml-4"></i>
                        <input type="text" id="area" name="area"
                            class="w-full px-4 py-3 bg-transparent border-none focus:outline-none text-lg text-gray-700"
                            placeholder="Enter your area to see local news..." value="{{ request.GET.area|default:'' }}"
                            required>
                        <button type="submit" class="search-button flex items-center justify-center">
                            <i class="fas fa-search text-white text-lg"></i>
                        </button>
                    </div>
                    <ul id="suggestions" class="absolute w-full mt-2 py-2 bg-white rounded-lg shadow-lg hidden z-10">
                    </ul>
                </form>
            </div>

            <!-- Popular Areas -->
            <div class="flex flex-wrap gap-3 justify-center mb-8">
                {% if trending_pages %}
                {% for page in trending_pages %}
                {% if page.name %}
                <a href="/{{ page.path }}" class="popular-area-chip">
                    <i class="fas fa-fire text-orange-500 mr-2"></i>
                    <span>{{ page.name|title }}</span>
                    <span class="ml-2 text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">{{ page.visits }}</span>
                </a>
                {% endif %}
                {% endfor %}
                {% endif %}
            </div>

            <!-- Recently Visited -->
            <div id="recently-visited-container" class="flex flex-wrap gap-3 justify-center mb-8">
            </div>

            <!-- Nearby Areas -->
            <div id="nearby-areas-container" class="flex flex-wrap gap-3 justify-center mb-8">
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Main Content Area -->
            <div class="lg:col-span-3">
                <!-- Featured Story -->
                {% if trending_articles %}
                <section class="mb-12">
                    <div class="section-header">
                        <h2 class="text-3xl font-bold text-gray-800">Featured Story</h2>
                    </div>
                    {% with trending_articles.0 as featured %}
                    <div class="featured-card">
                        <div class="relative">
                            <img src="{{ featured.cover_image }}" alt="{{ featured.title }}"
                                class="w-full h-64 md:h-80 object-cover">
                            <div class="absolute top-4 left-4">
                                <span class="category-badge">{{ featured.category|title }}</span>
                            </div>
                            <div class="absolute top-4 right-4">
                                <span class="trending-badge">
                                    <i class="fas fa-fire"></i> Trending
                                </span>
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-2xl md:text-3xl font-bold mb-4 leading-tight">
                                {% if featured.area %}
                                <a href="{% url 'article_detail_by_slug' area_name=featured.area.name article_slug=featured.slug %}"
                                    class="hover:text-blue-600 transition-colors">{{ featured.title }}</a>
                                {% else %}
                                {{ featured.title }}
                                {% endif %}
                            </h3>
                            <p class="text-gray-600 mb-4 text-lg leading-relaxed">
                                {{ featured.content|truncatewords:30 }}
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>{{ featured.created_at|timesince }} ago
                                    </span>
                                    {% if featured.total_visits %}
                                    <span class="text-sm text-blue-600">
                                        <i class="fas fa-eye mr-1"></i>{{ featured.total_visits }} views
                                    </span>
                                    {% endif %}
                                </div>
                                <button class="flex items-center space-x-2 text-red-500 hover:text-red-600">
                                    <i class="fas fa-heart"></i>
                                    <span>{{ featured.likes }}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                </section>
                {% endif %}

                <!-- Latest News Grid -->
                <section class="mb-12" id="trending"></section>
                <div class="section-header">
                    <h2 class="text-3xl font-bold text-gray-800">Latest News</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for article in trending_articles|slice:"1:7" %}
                    <article class="news-card">
                        <div class="relative">
                            <img src="{{ article.cover_image }}" alt="{{ article.title }}"
                                class="w-full h-48 object-cover">
                            <div class="absolute top-3 left-3">
                                <span class="category-badge text-xs">{{ article.category|title }}</span>
                            </div>
                        </div>
                        <div class="p-5">
                            <h3 class="text-lg font-bold mb-2 line-clamp-2">
                                {% if article.area %}
                                <a href="{% url 'article_detail_by_slug' area_name=article.area.name article_slug=article.slug %}"
                                    class="hover:text-blue-600 transition-colors">{{ article.title }}</a>
                                {% else %}
                                {{ article.title }}
                                {% endif %}
                            </h3>
                            <p class="text-gray-600 text-sm mb-3 line-clamp-3">
                                {{ article.content|truncatewords:15 }}
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>
                                    <i class="fas fa-clock mr-1"></i>{{ article.created_at|timesince }} ago
                                </span>
                                <div class="flex items-center space-x-3">
                                    {% if article.total_visits %}
                                    <span><i class="fas fa-eye mr-1"></i>{{ article.total_visits }}</span>
                                    {% endif %}
                                    <button class="text-red-500 hover:text-red-600">
                                        <i class="fas fa-heart mr-1"></i>{{ article.likes }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
                </section>

                <!-- Community Highlights -->
                <section class="mb-12" id="community"></section>
                <div class="section-header">
                    <h2 class="text-3xl font-bold text-gray-800">Community Highlights</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-container p-6 text-center">
                        <i class="fas fa-users text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Active Communities</h3>
                        <p class="text-gray-600">Join thousands of neighbors sharing local news and updates</p>
                    </div>
                    <div class="glass-container p-6 text-center">
                        <i class="fas fa-newspaper text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Real-time Updates</h3>
                        <p class="text-gray-600">Get instant notifications about what's happening around you</p>
                    </div>
                    <div class="glass-container p-6 text-center">
                        <i class="fas fa-map-marked-alt text-4xl text-purple-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Hyperlocal Focus</h3>
                        <p class="text-gray-600">News that matters to your specific neighborhood and area</p>
                    </div>
                </div>
                </section>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <!-- Quick Links -->
                <div class="quick-links mb-8">
                    <h3 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-bolt mr-2"></i>Quick Actions
                    </h3>
                    <div class="space-y-2">
                        <a href="{% url 'post-create' %}" class="quick-link-item">
                            <i class="fas fa-plus-circle mr-3"></i>
                            <span>Submit News</span>
                        </a>
                        <a href="{% url 'advertisement-create' %}" class="quick-link-item">
                            <i class="fas fa-bullhorn mr-3"></i>
                            <span>Post Advertisement</span>
                        </a>
                        <a href="#community" class="quick-link-item">
                            <i class="fas fa-comments mr-3"></i>
                            <span>Community Forum</span>
                        </a>
                        <a href="#" class="quick-link-item" onclick="showComingSoon('Local Events')">
                            <i class="fas fa-calendar-alt mr-3"></i>
                            <span>Local Events</span>
                        </a>
                    </div>
                </div>

                <!-- Trending Topics -->
                <div class="glass-container p-6 mb-8">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-hashtag mr-2 text-blue-600"></i>Trending Topics
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm">#LocalBusiness</span>
                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">245</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm">#CommunityEvent</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">189</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm">#TrafficUpdate</span>
                            <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">156</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm">#WeatherAlert</span>
                            <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">134</span>
                        </div>
                    </div>
                </div>

                <!-- Weather Widget -->
                <div class="glass-container p-6 mb-8">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-cloud-sun mr-2 text-yellow-600"></i>Local Weather
                    </h3>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600 mb-2">22¬∞C</div>
                        <div class="text-sm text-gray-600 mb-2">Partly Cloudy</div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>High: 25¬∞</span>
                            <span>Low: 18¬∞</span>
                        </div>
                    </div>
                </div>

                <!-- Newsletter Signup -->
                <div class="glass-container p-6">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-envelope mr-2 text-green-600"></i>Stay Updated
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Get daily news digest delivered to your inbox</p>
                    <form class="space-y-3" onsubmit="handleNewsletterSignup(event)">
                        <input type="email" id="newsletter-email" placeholder="Enter your email" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        <button type="submit"
                            class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Subscribe
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <img src="{% static 'news_app/images/transparent.webp' %}" alt="Lokkal News"
                        class="h-12 w-auto mb-4">
                    <p class="text-gray-400 text-sm">Your trusted source for hyperlocal news and community updates.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-white">About Us</a></li>
                        <li><a href="#" class="hover:text-white">Contact</a></li>
                        <li><a href="#" class="hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-white">Terms of Service</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Categories</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-white">Local News</a></li>
                        <li><a href="#" class="hover:text-white">Community</a></li>
                        <li><a href="#" class="hover:text-white">Business</a></li>
                        <li><a href="#" class="hover:text-white">Events</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Follow Us</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-facebook-f text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white"></a>
                        <i class="fab fa-instagram text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-linkedin-in text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-400">
                <p>&copy; 2025 Lokkal News. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        $(document).ready(function () {
            // Manage and display recently visited communities
            let recentlyVisited = JSON.parse(localStorage.getItem('recentlyVisited')) || [];
            const serverVisited = {{ recently_visited|safe }};

            // Update localStorage with data from the server (session)
            if (serverVisited.length > 0) {
                serverVisited.forEach(function(areaName) {
                    // Avoid duplicates
                    const index = recentlyVisited.indexOf(areaName);
                    if (index > -1) {
                        recentlyVisited.splice(index, 1);
                    }
                    recentlyVisited.unshift(areaName);
                });
                localStorage.setItem('recentlyVisited', JSON.stringify(recentlyVisited.slice(0, 5)));
            }

            // Display the list
            if (recentlyVisited.length > 0) {
                let html = '<h3 class="text-2xl font-bold text-gray-800 w-full text-center mb-4">Recently Visited</h3>';
                recentlyVisited.forEach(function(areaName) {
                    html += `
                        <a href="/${areaName}/" class="popular-area-chip">
                            <i class="fas fa-history text-purple-500 mr-2"></i>
                            <span>${areaName}</span>
                        </a>
                    `;
                });
                $('#recently-visited-container').html(html);
            }

            // Enhanced search functionality
            $('#area').on('keyup', function () {
                var query = $(this).val();
                if (query.length > 2) {
                    $.ajax({
                        url: 'autocomplete/area/',
                        data: { 'term': query },
                        success: function (data) {
                            $('#suggestions').empty();
                            if (data.length > 0) {
                                $('#suggestions').show();
                                data.forEach(function (item) {
                                    $('#suggestions').append(
                                        '<li class="px-4 py-3 hover:bg-blue-50 cursor-pointer text-base border-b border-gray-100 last:border-b-0 flex items-center">' +
                                        '<i class="fas fa-map-marker-alt text-blue-500 mr-3"></i>' +
                                        '<span>' + item + '</span>' +
                                        '</li>'
                                    );
                                });
                            } else {
                                $('#suggestions').hide();
                            }
                        }
                    });
                } else {
                    $('#suggestions').hide();
                }
            });

            // Suggestion click handler
            $(document).on('click', '#suggestions li', function () {
                $('#area').val($(this).find('span').text());
                $('#suggestions').hide();
            });

            // Hide suggestions when clicking outside
            $(document).click(function (e) {
                if (!$(e.target).closest('#area, #suggestions').length) {
                    $('#suggestions').hide();
                }
            });

            function fetchNearbyAreas() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        $('#location-denied-banner').hide();
                        $('#location-modal').hide();
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        $.ajax({
                            url: '/api/nearby-areas/',
                            data: {
                                'lat': lat,
                                'lon': lon
                            },
                            success: function(data) {
                                if (data.areas.length > 0) {
                                    let html = '';
                                    data.areas.forEach(function(area) {
                                        html += `
                                            <a href="/${area.name}/" class="flex items-center p-4 rounded-lg hover:bg-blue-50 transition-colors border border-gray-200 hover:border-blue-300">
                                                <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                                    <i class="fas fa-map-marker-alt text-blue-600"></i>
                                                </div>
                                                <div class="flex-grow">
                                                    <div class="font-semibold text-gray-900">${area.name}</div>
                                                    <div class="text-sm text-gray-500">${area.distance.toFixed(1)} km away</div>
                                                </div>
                                                <div class="flex-shrink-0">
                                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                                </div>
                                            </a>
                                        `;
                                    });
                                    $('#nearby-areas-list').html(html);
                                    $('#nearby-areas-modal').show();
                                } else {
                                    $('#nearby-areas-list').html(`
                                        <div class="text-center py-8">
                                            <i class="fas fa-search text-gray-400 text-3xl mb-4"></i>
                                            <p class="text-gray-600">No communities found nearby.</p>
                                            <p class="text-sm text-gray-500 mt-2">Try searching for your area using the search box above.</p>
                                        </div>
                                    `);
                                    $('#nearby-areas-modal').show();
                                }
                            },
                            error: function() {
                                $('#nearby-areas-list').html(`
                                    <div class="text-center py-8">
                                        <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl mb-4"></i>
                                        <p class="text-gray-600">Unable to fetch nearby areas.</p>
                                        <p class="text-sm text-gray-500 mt-2">Please try searching for your area manually.</p>
                                    </div>
                                `);
                                $('#nearby-areas-modal').show();
                            }
                        });
                    }, function(error) {
                        $('#location-modal').hide();
                        if (error.code == error.PERMISSION_DENIED) {
                            $('#location-denied-banner').show();
                        } else {
                            alert('Unable to get your location. Please search for your area manually.');
                        }
                    });
                }
            }

            // Welcome banner functionality
            function checkWelcomeBanner() {
                const hasSeenWelcome = localStorage.getItem('hasSeenWelcome');
                if (!hasSeenWelcome) {
                    setTimeout(function() {
                        $('#welcome-banner').removeClass('hidden').addClass('welcome-banner-animation');
                    }, 500); // Show banner after a short delay
                }
            }

            // Initialize welcome banner
            checkWelcomeBanner();

            // Handle welcome banner buttons
            $('#get-started-btn').on('click', function() {
                localStorage.setItem('hasSeenWelcome', 'true');
                $('#welcome-banner').slideUp(300, function() {
                    $('#location-modal').show();
                });
            });

            $('#dismiss-banner').on('click', function() {
                localStorage.setItem('hasSeenWelcome', 'true');
                $('#welcome-banner').slideUp(300);
            });

            // Location permission handling - only check if user hasn't seen welcome or clicked get started
            const hasSeenWelcome = localStorage.getItem('hasSeenWelcome');
            if (hasSeenWelcome && navigator.permissions) {
                navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                    if (result.state === 'denied') {
                        $('#location-denied-banner').show();
                    }
                    result.onchange = function() {
                        if (result.state === 'denied') {
                            $('#location-denied-banner').show();
                            $('#location-modal').hide();
                        } else if (result.state === 'granted') {
                            $('#location-denied-banner').hide();
                        }
                    }
                });
            }

            $('#allow-location').on('click', function() {
                $('#location-modal').hide();
                fetchNearbyAreas();
            });

            $('#deny-location').on('click', function() {
                $('#location-modal').hide();
                $('#location-denied-banner').show();
            });

            $('#request-location-access').on('click', function() {
                fetchNearbyAreas();
            });

            $('#close-nearby-modal').on('click', function() {
                $('#nearby-areas-modal').hide();
            });

            // Smooth scrolling for anchor links
            $('a[href^="#"]').on('click', function (event) {
                var target = $(this.getAttribute('href'));
                if (target.length) {
                    event.preventDefault();
                    $('html, body').stop().animate({
                        scrollTop: target.offset().top - 100
                    }, 1000);
                }
            });

            // Like button functionality
            $('.news-card, .featured-card').on('click', '.fa-heart', function (e) {
                e.preventDefault();
                var $this = $(this);
                var $parent = $this.parent();
                var currentLikes = parseInt($parent.find('span').text()) || 0;

                // Toggle heart color and increment likes
                if ($this.hasClass('text-red-500')) {
                    $this.removeClass('text-red-500').addClass('text-gray-400');
                    $parent.find('span').text(Math.max(0, currentLikes - 1));
                } else {
                    $this.removeClass('text-gray-400').addClass('text-red-500');
                    $parent.find('span').text(currentLikes + 1);
                }
            });

            // Mobile menu toggle (if you add a mobile menu later)
            $('.mobile-menu-button').on('click', function () {
                $('.mobile-menu').toggleClass('hidden');
            });

            // Add loading animation to search button
            $('form').on('submit', function () {
                var $button = $(this).find('.search-button');
                $button.html('<i class="fas fa-spinner fa-spin text-white text-lg"></i>');
            });

            // Parallax effect for hero section (desktop only)
            if (window.innerWidth > 768) {
                $(window).scroll(function () {
                    var scrolled = $(this).scrollTop();
                    var parallax = $('.hero-section');
                    var speed = 0.5;
                    parallax.css('background-position', 'center ' + (scrolled * speed) + 'px');
                });
            }

            // Notification toggle function
            function toggleNotifications() {
                alert('Notifications feature coming soon! We\'ll notify you about breaking news in your area.');
            }

            // Coming soon function for features not yet implemented
            function showComingSoon(feature) {
                alert(feature + ' feature is coming soon! Stay tuned for updates.');
            }

            // Newsletter signup handler
            function handleNewsletterSignup(event) {
                event.preventDefault();
                const email = document.getElementById('newsletter-email').value;
                if (email) {
                    alert('Thank you for subscribing! You\'ll receive daily news updates at ' + email);
                    document.getElementById('newsletter-email').value = '';
                } else {
                    alert('Please enter a valid email address.');
                }
            }

            function animateStats() {
                $('.stats-card').each(function () {
                    var $this = $(this);
                    var $number = $this.find('.text-2xl');
                    var finalNumber = $number.text().replace(/\D/g, '');

                    if (finalNumber) {
                        var current = 0;
                        var increment = Math.ceil(finalNumber / 50);
                        var timer = setInterval(function () {
                            current += increment;
                            if (current >= finalNumber) {
                                current = finalNumber;
                                clearInterval(timer);
                            }
                            $number.text(current + ($number.text().includes('+') ? '+' : ''));
                        }, 30);
                    }
                });
            }

            // Trigger stats animation when in viewport
            $(window).scroll(function () {
            var statsSection = $('.stats-card').first();
            if (statsSection.length) {
                var elementTop = statsSection.offset().top;
                var elementBottom = elementTop + statsSection.outerHeight();
                var viewportTop = $(window).scrollTop();
                var viewportBottom = viewportTop + $(window).height();

                if (elementBottom > viewportTop && elementTop < viewportBottom) {
                    if (!statsSection.hasClass('animated')) {
                        statsSection.addClass('animated');
                        animateStats();
                    }
                }
            }
        });

        // Add hover effects to news cards
        $('.news-card, .featured-card').hover(
            function () {
                $(this).find('img').css('transform', 'scale(1.05)');
            },
            function () {
                $(this).find('img').css('transform', 'scale(1)');
            }
        );
        });

        // Add CSS transitions for image hover effects
        $('<style>')
            .prop('type', 'text/css')
            .html(
                "\
                .news-card img, .featured-card img {\n                    transition: transform 0.3s ease;\n                }\n                .line-clamp-2 {\n                    display: -webkit-box;\n                    -webkit-line-clamp: 2;\n                    -webkit-box-orient: vertical;\n                    overflow: hidden;\n                }\n                .line-clamp-3 {\n                    display: -webkit-box;\n                    -webkit-line-clamp: 3;\n                    -webkit-box-orient: vertical;\n                    overflow: hidden;\n                }\n            "
            )
            .appendTo('head');
    </script>
<div id="location-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 modal-backdrop flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-8 max-w-md mx-4 transform transition-all">
        <div class="text-center mb-6">
            <div class="text-4xl mb-4">üìç</div>
            <h3 class="text-2xl font-bold mb-4">Find Your Local Community</h3>
            <p class="text-gray-600 mb-4">Discover news and stories happening right in your neighborhood. We'll show you nearby communities to get started.</p>
            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-blue-800">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Your location data is only used to find nearby areas and is never stored.
                </p>
            </div>
        </div>
        <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4">
            <button id="deny-location" class="px-6 py-2 rounded-lg text-gray-600 bg-gray-200 hover:bg-gray-300 transition-colors">Skip for Now</button>
            <button id="allow-location" class="px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                <i class="fas fa-map-marker-alt mr-2"></i>Find Nearby Areas
            </button>
        </div>
    </div>
</div>
<div id="nearby-areas-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-8 max-w-md mx-auto">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h3 class="text-2xl font-bold">Communities Near You</h3>
                <p class="text-gray-600 text-sm">Choose a community to explore local news</p>
            </div>
            <button id="close-nearby-modal" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="nearby-areas-list" class="space-y-3 max-h-96 overflow-y-auto">
            <!-- Nearby areas will be injected here by JavaScript -->
        </div>
        <div class="mt-6 pt-4 border-t border-gray-200">
            <p class="text-xs text-gray-500 text-center">
                Don't see your area? You can search for it using the search box above.
            </p>
        </div>
    </div>
</div>
</body>

</html>